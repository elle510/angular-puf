/*
 * puf
 * hrahn@nkia.co.kr (Ahn Hyung-Ro)

 * Version: 1.0.0 - 2015-04-04
 * License: ISC
 */
"use strict";angular.module("ps.puf",["ps.directives","ps.validators"]),angular.module("ps.directives",["ps.directives.back","ps.directives.dropdown","ps.directives.checkbox","ps.directives.datepicker","ps.directives.focus","ps.directives.grid","ps.directives.modal","ps.directives.radio","ps.directives.select","ps.directives.stepper","ps.directives.tabs","ps.directives.tree"]),angular.module("ps.directives.back",[]).directive("psBack",["$window",function(a){return{restrict:"A",link:function(b,c){c.on("click",function(){a.history.back()})}}}]),angular.module("ps.directives.dropdown",[]).directive("psButtonDropdown",function(){return{restrict:"E",transclude:!0,replace:!0,scope:{type:"@",label:"@",btnClass:"@",iconClass:"@",isOpen:"="},template:function(a,b){angular.isDefined(b.type)||(b.type="single"),angular.isDefined(b.btnClass)||(b.btnClass="btn-default");var c,d="";return b.iconClass&&(d='<i class="'+b.iconClass+'"></i> '),c="single"==b.type?'<div class="btn-group" ps-dropdown-transclude><button type="button" class="btn '+b.btnClass+' dropdown-toggle" data-toggle="dropdown">'+d+'{{label}} <span class="caret"></span></button></div>':'<div class="btn-group" ps-dropdown-transclude><button type="button" class="btn '+b.btnClass+'">'+d+'{{label}}</button><button type="button" class="btn '+b.btnClass+' dropdown-toggle" data-toggle="dropdown"><span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button></div>'},link:function(a,b){a.$watch("isOpen",function(a){void 0!=a&&(a?b.hasClass("open")||b.addClass("open"):b.hasClass("open")&&b.removeClass("open"))})}}}).directive("psDropdownTransclude",function(){return{link:function(a,b,c,d,e){e(a.$parent,function(a){a.addClass("dropdown-menu"),"right"==c.dropdownPosition&&a.addClass("dropdown-menu-right"),a.attr("role","menu"),b.append(a)})}}}),angular.module("ps.directives.checkbox",[]).directive("psCheckbox",function(){return{restrict:"E",replace:!0,transclude:!0,scope:{name:"@",className:"@",inline:"@",ngModel:"=",ngTrueValue:"@",ngFalseValue:"@",ngChange:"&"},template:function(a,b){var c,d="";return d=angular.isDefined(b.className)?'<input type="checkbox" ng-model="ngModel" class="'+b.className+'" ng-change="ngChange()">':'<input type="checkbox" ng-model="ngModel" ng-change="ngChange()">',c="true"==b.inline?'<label class="checkbox-inline">'+d+'<span class="lbl" ng-transclude></span><input type="hidden" ng-value="ngModel"></label>':'<div class="checkbox"><label>'+d+'<span class="lbl" ng-transclude></span><input type="hidden" ng-value="ngModel"></label></div>'},link:function(a,b,c){angular.isDefined(c.name)&&b.find('input[type="hidden"]').attr("name",c.name),angular.isDefined(c.ngTrueValue)&&b.find('input[type="checkbox"]').attr("ng-true-value",c.ngTrueValue),angular.isDefined(c.ngFalseValue)&&b.find('input[type="checkbox"]').attr("ng-false-value",c.ngFalseValue),angular.isDefined(c.ngChange)||b.find('input[type="checkbox"]').removeAttr("ng-change"),angular.isDefined(c.disabled)&&b.find('input[type="checkbox"]').attr("disabled",!0),angular.isDefined(c.readonly)&&(b.find('input[type="checkbox"]').attr("readonly",!0),b.find('input[type="checkbox"]').on("click",function(){return!1}),b.find('input[type="checkbox"]').on("keydown",function(){return!1}))}}}),angular.module("ps.directives.datepicker",[]).directive("psDaterangepicker",["$compile",function(a){return{restrict:"E",replace:!0,scope:{options:"=",api:"=?"},link:function(b,c,d){var e,f,g=new Date,h=(g.getFullYear(),g.getMonth()+1,g.getDate(),{format:"YYYY-MM-DD"});b.$watch("options",function(g){f=$.extend({},h,g),c.children().empty(),e=angular.element('<div class="input-group"><span class="input-group-addon"><i class="fa fa-calendar"></i></span><input type="text" id="'+d.id+'" style="width:100%"/></div>'),a(e)(b),c.append(e),e.daterangepicker(f)})}}}]).directive("psDatetimepicker",["$compile",function(){return{restrict:"E",replace:!0,scope:{id:"@",name:"@",options:"=",data:"=?",insert:"=?",api:"=?"},template:"<div></div>",link:function(a,b,c){var d,e,f=new Date,g=f.getFullYear(),h=f.getMonth()+1,i=f.getDate(),j=g+"-"+h+"-"+i,k={pickTime:!1,defaultDate:j,format:"YYYY-MM-DD"};a.$watch("options",function(f){e=$.extend({},k,f),b.empty(),d=angular.element('<div class="input-group date"><input type="text" class="form-control" readonly/><span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span><input type="hidden"></div>'),b.append(d),angular.isDefined(c.id)&&b.find("div.input-group.date").attr("id",c.id),angular.isDefined(c.name)&&b.find('input[type="hidden"]').attr("name",c.name),d.datetimepicker(e),a.api={show:function(){d.data("DateTimePicker").show()},setDate:function(a){return d.data("DateTimePicker").setDate(a)},getDate:function(){return d.data("DateTimePicker").getDate()},enable:function(){d.data("DateTimePicker").enable()},disable:function(){d.data("DateTimePicker").disable()}}})}}}]),angular.module("ps.directives.focus",[]).directive("psFocus",function(){return{link:function(a,b){b[0].focus()}}}),angular.module("ps.directives.grid",[]).directive("psGrid",function(){return{restrict:"E",replace:!0,scope:{gridId:"@",pagerId:"@",dClass:"@",options:"=",data:"=?",insert:"=?",api:"=?"},template:function(a,b){var c;return c=angular.isDefined(b.dClass)?'<div class="'+b.dClass+'"></div>':"<div></div>"},link:function(a,b,c){var d,e,f,g={mtype:"POST",datatype:"json",jsonReader:{page:"viewData.page",total:"viewData.total",root:"viewData.list",records:"viewData.records",repeatitems:!1,cell:"viewData.cell"},rowNum:20,autowidth:!0,height:"auto",multiselect:!0,multiboxonly:!0,recordtext:$ps_locale.grid.recordtext,emptyrecords:$ps_locale.grid.emptyrecords,loadtext:$ps_locale.grid.loadtext,pgtext:$ps_locale.grid.pgtext};a.$watch("options",function(h){if(f=$.extend({},g,h),b.empty(),d=angular.element('<table id="'+c.gridId+'"></table>'),b.append(d),c.pagerId){f.pager="#"+c.pagerId;var i=angular.element(f.pager);0==i.length&&(e=angular.element('<div id="'+c.pagerId+'"></div>'),b.append(e))}d.jqGrid(f),a.vapi=function(){var a=Array.prototype.slice.call(arguments,0);return d.jqGrid.apply(d,a)},a.api={insert:function(b){if(b){for(var c=0;c<b.length;c++)a.data.push(b[c]);d.jqGrid("setGridParam",{data:a.data}).trigger("reloadGrid")}},clear:function(){a.data.length=0,d.jqGrid("clearGridData",{data:a.data}).trigger("reloadGrid")},refresh:function(){d.jqGrid("clearGridData").jqGrid("setGridParam",{data:a.data}).trigger("reloadGrid")}}}),a.$watch("data",function(a){d.jqGrid("setGridParam",{data:a}).trigger("reloadGrid")})}}}),angular.module("ps.directives.modal",[]).directive("psModal",function(){return{restrict:"EA",transclude:!0,replace:!0,scope:{modalClass:"@",size:"@",backdrop:"@"},template:'<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true"><div class="modal-dialog" ng-class="{\'modal-sm\': size == \'sm\', \'modal-lg\': size == \'lg\'}"><div class="modal-content" ps-modal-transclude></div></div></div>',link:function(a,b,c){b.addClass(c.modalClass||""),a.size=c.size,"static"==c.backdrop&&(b.attr("data-backdrop",c.backdrop),b.attr("data-keyboard",!1))}}}).directive("psModalTransclude",function(){return{link:function(a,b,c,d,e){e(a.$parent,function(a){b.empty(),b.append(a)})}}}),angular.module("ps.directives.radio",[]).directive("psRadio",function(){return{restrict:"E",replace:!0,transclude:!0,scope:{ngModel:"=",ngValue:"=",ngChange:"&"},template:'<div><label><input type="radio" ng-model="ngModel" ng-value="ngValue" ng-change="ngChange()"><span class="lbl" ng-transclude></span></label></div>',compile:function(a,b){void 0!=b.name&&a.find("input").attr("name",b.name),void 0!=b.value&&a.find("input").attr("value",b.value),void 0==b.ngValue&&a.find("input").removeAttr("ng-value"),void 0==b.ngChange&&a.find("input").removeAttr("ng-change");var c=a.children();if("true"==b.inline)c.addClass("radio-inline"),a.replaceWith(c);else{var d=angular.element('<div class="radio"></div>');d.append(c),a.replaceWith(d)}return function(){}}}}),angular.module("ps.directives.select",[]).directive("psSelect",function(){return{restrict:"E",replace:!0,scope:{array:"=",optionName:"@",optionValue:"@",optionGroup:"@",title:"@",api:"=?"},template:function(a,b){var c="";return angular.isDefined(b.array)&&(angular.isDefined(b.optionValue)&&(c+="a[optionValue] as "),angular.isDefined(b.optionName)&&(c+="a[optionName] "),angular.isDefined(b.optionGroup)&&(c+="group by a[optionGroup] "),c+="for a in array",console.log(c)),angular.isDefined(b.title)||(b.title="선택하세요"),'<select ng-options="'+c+'"><option value="">-- {{title}} --</option></select>'},link:function(a,b){var c,d={};a.$watch("options",function(a){c=$.extend({},d,a),b.selectpicker(c)}),a.api={show:function(){b.selectpicker("show")},hide:function(){b.selectpicker("hide")},enable:function(){b.prop("disabled",!1)},disable:function(){b.prop("disabled",!0)},refresh:function(){b.selectpicker("refresh")},selectAll:function(){b.selectpicker("selectAll")},deselectAll:function(){b.selectpicker("deselectAll")},render:function(){b.selectpicker("render")}}}}}),angular.module("ps.directives.stepper",[]).directive("psStepper",function(){return{restrict:"EA",require:"ngModel",scope:{name:"@",min:"=",max:"=",step:"=",direction:"@"},template:function(a,b){angular.isDefined(b.direction)||(b.direction="vertical");var c;if("vertical"==b.direction||"horizontal"==b.direction){var d;d="vertical"==b.direction?"input-group-btn-vertical":"input-group-btn-horizontal",c='<div class="input-group stepper"><input type="text" class="form-control"><div class="'+d+'"><button class="btn btn-default" ng-disabled="isOverMax()" ng-click="increment()"><i class="fa fa-caret-up"></i></button><button class="btn btn-default" ng-disabled="isOverMin()" ng-click="decrement()"><i class="fa fa-caret-down"></i></button></div></div>'}return c},link:function(a,b,c,d){function e(){var b=!(a.isOverMin(!0)||a.isOverMax(!0));d.$setValidity("outOfBounds",b)}function f(a){d.$setViewValue(d.$viewValue+a),d.$render()}angular.isDefined(c.name)&&b.find("input").attr("name",c.name),angular.isDefined(c.disabled)&&(b.find("input").attr("disabled",!0),b.find("button").attr("disabled",!0)),d.$render=function(){b.find("input").val(d.$viewValue),e()},d.$formatters.push(function(a){return parseInt(a,10)}),d.$parsers.push(function(a){return parseInt(a,10)}),a.isOverMin=function(b){var c=b?0:a.step;return angular.isDefined(a.min)&&d.$viewValue-c<parseInt(a.min,10)},a.isOverMax=function(b){var c=b?0:a.step;return angular.isDefined(a.max)&&d.$viewValue+c>parseInt(a.max,10)},a.increment=function(){angular.isDefined(a.step)&&!isNaN(Number(a.step))&&f(+Number(a.step))},a.decrement=function(){angular.isDefined(a.step)&&!isNaN(Number(a.step))&&f(-Number(a.step))},e(),a.$watch("min+max",function(){e()})}}}),angular.module("ps.directives.tabs",[]).controller("TabsetController",["$scope",function(a){var b=this,c=b.tabs=a.tabs=[];b.select=function(a){angular.forEach(c,function(b){b.active&&b!==a&&(b.active=!1,b.onDeselect())}),a.active=!0,a.onSelect()},b.addTab=function(a){c.push(a),1===c.length?a.active=!0:a.active&&b.select(a)},b.removeTab=function(a){var b=c.indexOf(a);if(a.active&&c.length>1){b==c.length-1?b-1:b+1}c.splice(b,1)}}]).directive("psTabset",function(){return{restrict:"EA",transclude:!0,replace:!0,scope:{type:"@",api:"=?"},controller:"TabsetController",controllerAs:"tabsetCtrl",template:'<div><ul class="nav nav-{{type || \'tabs\'}}" ng-class="{\'nav-stacked\': vertical, \'nav-justified\': justified}" ng-transclude></ul><div class="tab-content"><div class="tab-pane" ng-repeat="tab in tabs" ng-class="{active: tab.active}"ps-tab-content-transclude="tab"><div ng-if="tab.templateUrl" ng-include="tab.templateUrl"></div></div></div></div>',link:function(a,b,c){a.vertical=angular.isDefined(c.vertical)?a.$parent.$eval(c.vertical):!1,a.justified=angular.isDefined(c.justified)?a.$parent.$eval(c.justified):!1,a.api={addTab:function(b){a.tabsetCtrl.addTab(b)}}}}}).directive("psTab",["$parse",function(a){return{require:"^psTabset",restrict:"EA",replace:!0,template:'<li ng-class="{active: active, disabled: disabled}"><a ng-click="select()" ps-tab-heading-transclude>{{heading}}</a><a ng-if="removable" ng-click="onRemove()">X</a></li>',transclude:!0,scope:{templateUrl:"@",active:"=?",heading:"@",onSelect:"&select",onDeselect:"&deselect",removable:"=",onRemove:"&remove"},controller:function(){},compile:function(b,c,d){return function(b,c,e,f){b.$watch("active",function(a){a&&f.select(b)}),b.disabled=!1,e.disabled&&b.$parent.$watch(a(e.disabled),function(a){b.disabled=!!a}),b.select=function(){b.disabled||(b.active=!0)},b.remove=function(){b.disabled||f.removeTab(b)},f.addTab(b),b.$on("$destroy",function(){f.removeTab(b)}),b.$transcludeFn=d}}}}]).directive("psTabHeadingTransclude",function(){return{restrict:"A",require:"^psTab",link:function(a,b){a.$watch("headingElement",function(a){a&&(b.html(""),b.append(a))})}}}).directive("psTabContentTransclude",function(){function a(a){return a.tagName&&(a.hasAttribute("ps-tab-heading")||a.hasAttribute("data-ps-tab-heading")||"ps-tab-heading"===a.tagName.toLowerCase()||"data-ps-tab-heading"===a.tagName.toLowerCase())}return{restrict:"A",require:"^psTabset",link:function(b,c,d){var e=b.$eval(d.psTabContentTransclude);e.$transcludeFn(e.$parent,function(b){angular.forEach(b,function(b){a(b)?e.headingElement=b:c.append(b)})})}}}),angular.module("ps.directives.tree",[]).directive("psTree",function(){return{restrict:"E",replace:!0,scope:{id:"@",name:"@",options:"=",changed:"=?",selectNode:"=?",dblclick:"=?"},template:"<div></div>",link:function(a,b,c){var d,e,f={};a.$watch("options",function(g){e=$.extend({},f,g),b.empty(),d=angular.element("<div></div>"),angular.isDefined(c.id)&&(b.removeAttr("id"),d.attr("id",c.id)),angular.isDefined(c.name)&&d.attr("name",c.name),b.append(d),d.jstree(e),d.on("changed.jstree",a.changed),d.on("dblclick.jstree",a.dblclick),d.on("select_node.jstree",function(b,c){a.selectNode(b,c),b.stopImmediatePropagation()})})}}}),angular.module("ps.validators",["ps.validators.password"]),angular.module("ps.validators.password",[]).directive("psPasswordValidate",["$compile",function(a){return{restrict:"A",require:"ngModel",link:function(b,c,d,e){var f=c[0].form.name+"."+c[0].id+".$error.passwordValidate",g=angular.element('<span class="error-msg" ng-show="'+f+'">'+$ps_locale.validators.passwordErrorMsg+"</span>");a(g)(b),c.after(g);var h=!1,i=g.css("display");$(c[0]).focusout(function(){""!=e.$viewValue&&void 0!=e.$viewValue&&(h=!0,g.css("display",i))}),e.$parsers.unshift(function(a){return 0==h&&g.css("display","none"),b.pwdValidLength=a&&a.length>=8?"valid":void 0,b.pwdHasLetter=a&&/[A-z]/.test(a)?"valid":void 0,b.pwdHasNumber=a&&/\d/.test(a)?"valid":void 0,b.pwdValidLength&&b.pwdHasLetter&&b.pwdHasNumber?(e.$setValidity("passwordValidate",!0),a):void e.$setValidity("passwordValidate",!1)})}}}]);